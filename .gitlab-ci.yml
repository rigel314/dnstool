stages:
  - build

build:
  stage: build
  tags:
    - linux
    - docker
  image: golang
  artifacts:
    paths:
      - dnstool.linux.*
      - dnstool.windows.*
      - dnstool.darwin.*
      - config.json
  script:
    - ver=`git rev-parse HEAD`
    - GOOS=linux GOARCH=amd64 go build -o dnstool.linux.amd64 -ldflags "-X main.GIT_VER=$ver -w -s" *.go
    - GOOS=linux GOARCH=386 go build -o dnstool.linux.386 -ldflags "-X main.GIT_VER=$ver -w -s" *.go
    - GOOS=windows GOARCH=amd64 go build -o dnstool.windows.amd64 -ldflags "-X main.GIT_VER=$ver -w -s" *.go
    - GOOS=windows GOARCH=386 go build -o dnstool.windows.386 -ldflags "-X main.GIT_VER=$ver -w -s" *.go
    - GOOS=darwin GOARCH=amd64 go build -o dnstool.darwin.amd64 -ldflags "-X main.GIT_VER=$ver -w -s" *.go
